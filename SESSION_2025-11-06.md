# 작업 세션 정리 (2025-11-06)

## 🎯 완료된 작업

### 1. 텍스트 기반 만다라트 생성 기능 ✅
**목적:** LLM으로 생성한 텍스트를 붙여넣어 만다라트 자동 생성

**구현 내용:**
- `supabase/functions/parse-mandalart-text/index.ts` - Perplexity API 기반 텍스트 파싱
- MandalartCreatePage.tsx - "텍스트 붙여넣기" 옵션 추가 (3가지 생성 방식)
- Database migration - `input_method`에 'text' 옵션 추가

**기술:**
- Perplexity API (sonar 모델)
- 비용: ~$0.002/회
- 정확도: 85-95%
- 다양한 텍스트 형식 지원 (bullets, markdown, JSON 등)

**테스트:** ✅ 정상 작동 확인

---

### 2. 자동추천 로직 개선 ✅
**개선 내용:**
- `src/lib/actionTypes.ts` - 우선순위 기반 패턴 매칭으로 전면 개편
- 확장된 키워드 패턴:
  - 완료/목표: 감량, 증가, 향상, 개선, 증진 추가
  - 참고: 원칙, 명언, 다짐, 신념, 기준, 명심 추가
  - 루틴 동사: 걷기, 달리기, 정리, 청소, 복습, 예습 등 추가
  - 숫자 단위: 권, 시간, 분, km, kg, 번, 회 등 추가

- 시간+동사 패턴 처리:
  - "30분 운동" → routine (시간 기반 반복)
  - "10kg 감량" → mission (수치 목표)

**테스트:** ✅ 25개 샘플 테스트 통과

---

### 3. Phase 1 UX 개선 (12가지 개선사항 중 4개) ✅

#### #9 액션 타입 기본값 - AI 추천 자동 적용 ⭐⭐⭐⭐
**문제:** 모든 액션이 'routine' 기본값 → 완료율 매우 낮음 → 유저 좌절

**해결:** MandalartCreatePage.tsx 수정
- 기존: 하드코딩된 'routine' 기본값
- 개선: `suggestActionType()` 결과를 자동 적용
- 효과: 초기 완료율이 현실적으로 설정되어 동기부여 향상

**파일:** `src/pages/MandalartCreatePage.tsx` (306-350줄)

---

#### #11 메뉴 순서 변경 ⭐⭐⭐
**문제:** 대시보드가 첫 번째 메뉴인데 매일 사용하는 건 "오늘의 실천"

**해결:** Navigation.tsx 수정
- 기존: 대시보드 → 오늘의 실천 → 만다라트 관리 → 통계
- 개선: **오늘의 실천 → 대시보드** → 만다라트 관리 → 통계
- 효과: 가장 자주 사용하는 메뉴가 맨 왼쪽 배치

**파일:** `src/components/Navigation.tsx` (14-19줄)

---

#### #3 Toast 시스템 구현 ⭐⭐⭐
**문제:** Inline alert가 컨텐츠를 밀어내어 CLS (Cumulative Layout Shift) 발생

**해결:**
- shadcn/ui toast 컴포넌트 추가
- App.tsx에 Toaster 추가
- NotificationSettingsPage의 모든 alert를 toast로 교체

**효과:**
- 화면이 밀리지 않는 깔끔한 알림
- Web Vitals CLS 점수 개선
- 우하단 토스트로 저장 버튼이 하단에 있어도 알림을 놓치지 않음

**파일:**
- `src/components/ui/toast.tsx` (새로 생성)
- `src/components/ui/toaster.tsx` (새로 생성)
- `src/hooks/use-toast.ts` (새로 생성)
- `src/App.tsx` (19줄, 198줄)
- `src/pages/NotificationSettingsPage.tsx` (전체 수정)

---

### 4. 버그 수정 ✅
**문제:** 세부목표 편집에서 '루틴', '미션', '참고' 버튼 클릭 시 빈 화면

**원인:**
- DB에는 `ai_suggestion`이 JSON string으로 저장
- ActionTypeSelector는 object 타입을 기대
- 타입 불일치로 인해 컴포넌트가 제대로 렌더링되지 않음

**해결:**
- SubGoalEditModal.tsx - string이면 JSON.parse, object면 그대로 전달
- TodayChecklistPage.tsx - 동일한 parsing 로직 적용

**파일:**
- `src/components/SubGoalEditModal.tsx` (348-352줄, 94줄, 101-113줄)
- `src/pages/TodayChecklistPage.tsx` (630-634줄)

**테스트:** ✅ 정상 작동 확인

---

## 📊 통계

### 작업 시간
- 텍스트 생성 기능: ~2시간
- 자동추천 로직 개선: ~1시간
- Phase 1 UX 개선: ~2시간
- 버그 수정: ~30분
- **총 작업 시간: 약 5.5시간**

### 변경된 파일
- 수정: 9개
- 신규: 6개
- Migration: 1개

---

## 🔜 다음 작업 (Phase 2)

### Phase 1 남은 작업 (1개)
- **#6 대시보드 개편** - 요약 + 액션 hub로 전면 개편 (예상 1-2시간)

### Phase 2 우선순위 작업 (6개)
1. **#12 이미지 다운로드** - html2canvas 구현 (모바일/태블릿/데스크탑 3가지 사이즈)
2. **#5 통계 UI 개선** - Phase 1+2 (동적 메시지, 애니메이션, 캘린더 히트맵)
3. **#8 온보딩** - 대시보드 배너 (신규 유저 가이드)
4. **#10 생성 UI 개선** - 4가지 개선 (명칭, 아이콘, 설명, 모바일 반응형)
5. **#2 저장 확인 개선** - Toast + 버튼 상태 변화
6. **#4 비활성 안내** - Info banner 추가

### Phase 3 마무리 작업 (2개)
1. **#7 알림설정 위치** - 네비게이션 아이콘 추가
2. **#1 알림 빈도 명칭** - 텍스트 변경 (매일 / 평일(월~금) / 직접 선택)

---

## 🎓 학습 내용

### Perplexity API 사용법
- 모델: `sonar` (빠르고 비용 효율적)
- Temperature: 0.1 (일관성 있는 파싱)
- System prompt를 user message에 포함
- JSON 추출 시 regex로 파싱 필요

### shadcn/ui Toast
- `npx shadcn@latest add toast`로 간단 설치
- `useToast()` 훅 사용
- Portal 기반으로 CLS 문제 없음
- variant: default, destructive

### TypeScript 타입 처리
- DB JSON string ↔ TypeScript object 변환
- `typeof` 체크 후 조건부 JSON.parse
- Union type 처리 시 명시적 타입 할당

---

## 📝 참고사항

### Git 상태
- Branch: main
- Uncommitted changes: 9 files modified, 6 files added
- Migration: 1 file (text input method 추가)

### 다음 세션 시작 시
1. Git commit 권장 (현재 작업 내용 저장)
2. `/sc:load` 또는 이 문서 참고하여 컨텍스트 복원
3. Phase 1 마무리 (#6 대시보드 개편) 또는 Phase 2 시작

---

## ✅ 체크리스트

- [x] 텍스트 기반 만다라트 생성 기능
- [x] 자동추천 로직 개선
- [x] #9 액션 타입 기본값 (AI 추천)
- [x] #11 메뉴 순서 변경
- [x] #3 Toast 시스템
- [x] 세부목표 편집 버그 수정
- [ ] #6 대시보드 개편
- [ ] Phase 2 작업들
- [ ] Phase 3 작업들

---

**작업 완료 시각:** 2025-11-06
**다음 세션:** Phase 1 마무리 또는 Phase 2 시작
