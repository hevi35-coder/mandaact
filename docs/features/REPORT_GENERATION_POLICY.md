# 리포트 생성 정책 v1.0

> 최종 확정일: 2025-11-30
> 목적: 유저 복귀 유도 + API 비용 절감

## 개요

MandaAct의 AI 리포트 생성 정책을 정의합니다. 실천 리포트와 목표 진단 두 가지 유형의 리포트에 대한 생성 규칙을 명시합니다.

---

## 1. 실천 리포트 (Weekly Practice Report)

### 1.1 자동 생성

| 항목 | 정책 |
|-----|------|
| **생성 주기** | 매주 1회 |
| **생성 시점** | 월요일 새벽 06:00 KST |
| **생성 조건** | 전주 실천 체크 1회 이상 |
| **분석 범위** | 전주 월요일 ~ 일요일 (7일) |
| **당일 포함** | 미포함 (월요일 새벽 생성 시, 전일 일요일까지만 분석) |

### 1.2 수동 생성 ("새로 생성하기" 버튼)

**기본 정책: 버튼 제거**

자동 생성으로 충분하며, 무제한 수동 생성은 API 비용 낭비로 이어짐.

### 1.3 예외: 첫 리포트 생성

| 항목 | 정책 |
|-----|------|
| **대상** | 리포트 0개 + 실천 1회 이상 유저 |
| **UI** | "첫 리포트 생성하기" 버튼 노출 |
| **분석 범위** | 가입일 ~ 어제 (최대 7일) |
| **제한** | 1회만 가능 |

### 1.4 UI 케이스별 표시

```
┌─────────────────────────────────────────────────────────────┐
│ Case 1: 리포트 있음 (일반 유저)                               │
│                                                             │
│   [실천 리포트 카드]                                         │
│   📅 다음 리포트: 12월 9일 (월)                              │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ Case 2: 리포트 없음 + 실천 있음 (신규 유저)                   │
│                                                             │
│   [빈 상태 카드]                                             │
│   ✨ 첫 리포트 생성하기  [버튼]                               │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ Case 3: 리포트 없음 + 실천 없음                              │
│                                                             │
│   [안내 카드]                                                │
│   실천을 시작하면 매주 월요일                                 │
│   AI 리포트가 자동으로 생성됩니다                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 목표 진단 (Goal Diagnosis)

### 2.1 생성 방식

| 항목 | 정책 |
|-----|------|
| **자동 생성** | 없음 |
| **수동 생성** | 만다라트 생성/수정 시 1회 제안 |
| **대상** | 활성화된 만다라트 보유 유저 |

### 2.2 생성 제한

- 만다라트당 1회 진단 (재진단 시 이전 진단 대체)
- 만다라트 내용 변경 시에만 재진단 제안

---

## 3. 지난 실천리포트 히스토리

| 항목 | 정책 |
|-----|------|
| **표시 개수** | 최대 4개 (최근 4주) |
| **정렬** | 최신순 |
| **UI** | 접이식 (펼치면 상세 내용) |

---

## 4. 알림 연동

### 4.1 실천 리포트 알림

| 시점 | 알림 내용 |
|-----|----------|
| 월요일 06:00 | "이번 주 실천 리포트가 도착했어요!" |

### 4.2 알림 조건

- 전주 실천 1회 이상인 유저에게만 발송
- 알림 설정이 켜진 유저에게만 발송

---

## 5. API 비용 절감 효과

| 항목 | 변경 전 | 변경 후 |
|-----|--------|--------|
| 주당 최대 호출 | 무제한 | 1회 (자동) |
| 신규 유저 | 무제한 | 1회 (첫 리포트) |
| 비활성 유저 | 무제한 | 0회 |

**예상 절감률**: 50-60%

---

## 6. 구현 체크리스트

### 6.1 백엔드

- [ ] 월요일 새벽 자동 생성 Cron Job 구현
- [ ] 실천 체크 1회 이상 조건 필터링
- [ ] 첫 리포트 생성 API (1회 제한 로직)

### 6.2 프론트엔드

- [ ] "새로 생성하기" 버튼 제거
- [ ] "다음 리포트: X월 X일" 안내 텍스트 추가
- [ ] 첫 리포트 생성 버튼 (조건부 노출)
- [ ] 빈 상태 UI 업데이트

### 6.3 알림

- [ ] 리포트 생성 완료 시 푸시 알림 발송
- [ ] 알림 설정 연동

---

## 7. 관련 문서

- [알림 시스템 진행상황](./NOTIFICATION_SYSTEM_PROGRESS.md)
- [AI 리포트 개선사항](../archive/completed/AI_REPORT_IMPROVEMENTS.md)
- [PRD](../project/PRD_mandaact.md)

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|-----|------|----------|
| 2025-11-30 | v1.0 | 최초 정책 확정 |
